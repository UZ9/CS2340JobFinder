{% extends 'base.html' %}
{% block content %}
<header class="masthead bg-index text-white text-center py-4">
  <div class="container d-flex align-items-center flex-column pt-2">
    <h1>{{ title }}</h1>
    <p class="lead">Browse active job listings</p>
  </div>
</header>
<div class="container py-3">
  <div class="row">
    <div class="col-12">
      <div class="text-center mb-3">
        <strong class="text-uppercase fs-3 fw-bold">browse open listings</strong>
      </div>
    </div>
  </div>
</div>

<div class="container mt-3">
  <form method="get" class="d-flex justify-content-center">
    <input name="q" class="form-control me-2" style="max-width:320px;" placeholder="Search job title..." value="{{ q|default_if_none:'' }}" />
    <select name="sort" class="form-select me-2" style="max-width:220px;" onchange="this.form.submit()">
      <option value="-posted_date" {% if request.GET.sort == "-posted_date" or not request.GET.sort %}selected{% endif %}>Newest</option>
      <option value="title" {% if request.GET.sort == "title" %}selected{% endif %}>Title (A–Z)</option>
      <option value="location" {% if request.GET.sort == "location" %}selected{% endif %}>Location</option>
    </select>
    <button class="btn btn-primary me-2" type="submit">Search</button>
    <a href="{% url 'recruiting.index' %}" class="btn btn-outline-secondary">Clear</a>
  </form>
</div>

<div class="container py-4">
  <div class="row">
    <div class="col-12">
      {% if listings %}
        <div class="listings">
          {% for job in listings %}
            <div class="mb-3 pb-2">
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">{{ job.title }}</h5>
                <small class="text-muted">{{ job.posted_date|date:"M d, Y" }}</small>
              </div>
              <p class="mb-1">{{ job.company }} — {{ job.location }}</p>
              {% if job.pay_range %}
                <p class="mb-1 text-muted"><strong>Pay:</strong> {{ job.pay_range }}</p>
              {% endif %}
              <small>{{ job.description|truncatechars:140 }}</small>
              <div class="mt-2 text-end">
                <a href="{% url 'recruiting.edit' %}?id={{ job.id }}" class="btn btn-sm btn-outline-primary">Edit</a>
              </div>
            </div>
            {% if not forloop.last %}
              <hr class="my-3" />
            {% endif %}
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-info">No active listings found.</div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock content %}