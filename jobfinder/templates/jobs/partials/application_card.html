<div class="application-card" draggable="true" data-application-id="{{ application.id }}">
    <div class="d-flex justify-content-between align-items-start mb-2">
        <div>
            <h6 class="mb-1">
                {% if application.applicant.get_full_name %}
                    {{ application.applicant.get_full_name }}
                {% else %}
                    {{ application.applicant.username }}
                {% endif %}
            </h6>
            <small class="text-muted">
                <i class="fas fa-envelope"></i> {{ application.applicant.email }}
            </small>
        </div>
        <span class="notification-status badge {{ application.notified|yesno:'bg-success,bg-warning' }}">
            {{ application.notified|yesno:'Notified,Pending' }}
        </span>
    </div>
    
    <div class="mb-2">
        <small class="text-muted">
            <i class="fas fa-clock"></i> Applied {{ application.applied_at|timesince }} ago
        </small>
        {% if application.status_updated_at != application.applied_at %}
        <br>
        <small class="text-muted">
            <i class="fas fa-sync"></i> Updated {{ application.status_updated_at|timesince }} ago
        </small>
        {% endif %}
    </div>
    
    {% if application.cover_note %}
    <div class="mb-2">
        <small>
            <strong>Cover Note:</strong><br>
            {{ application.cover_note|truncatewords:15 }}
        </small>
    </div>
    {% endif %}
    
    <div class="btn-group btn-group-sm w-100 mt-2" role="group">
        <button type="button" class="btn btn-outline-primary" onclick="openMessages({{ application.id }})" title="Message Applicant">
            <i class="fas fa-comments"></i>
            {% with unread_count=application.messages.all|length %}
                {% if unread_count > 0 %}
                    <span class="badge bg-danger">{{ unread_count }}</span>
                {% endif %}
            {% endwith %}
        </button>
        <button type="button" class="btn btn-outline-success notify-btn" onclick="notifyApplicant(this)" title="Notify Applicant of Status Update">
            <i class="fas fa-bell"></i>
        </button>
        <button type="button" class="btn btn-outline-danger" onclick="openRejectModal({{ application.id }}, this.closest('.application-card'))" title="Reject Application">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>
